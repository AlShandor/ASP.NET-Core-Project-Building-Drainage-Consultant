@model IEnumerable<MerchantServiceModel>

@{
    ViewBag.Title = "All Merchants";
}

<div class="row">
    @*Map*@
    <div class="shadow" id="myMap" style="position:relative;width:100%;height:500px;"></div>
</div>

<div class="row pt-5">
    @*List of Merchants*@
    @if (!Model.Any())
    {
        <h2 class="text-center">No Merchants found!</h2>
    }

    @foreach (var merchant in Model)
    {
        <div class="col-6 col-md-6 col-lg-4 mb-3">
            <div class="shadow-sm card h-100 border-1">
                <div class="card-body text-center">
                    <h4 class="card-title text-center">
                        <span class="font-weight-bold text-dark text-uppercase small">@merchant.Name</span>
                    </h4>
                    <span class="font-weight-bold text-dark text-uppercase small">@merchant.Address</span>
                    <span class="font-weight-bold text-dark text-uppercase small">@merchant.City</span>
                    <span class="font-weight-bold text-dark text-uppercase small">@merchant.Email</span>
                    <span class="font-weight-bold text-dark text-uppercase small">@merchant.Phone</span>
                    <span class="font-weight-bold text-dark text-uppercase small">@merchant.Website</span>

                    @if (User.IsAdmin())
                    {
                        <div class="pt-1 position-relative">
                            <a asp-controller="Merchants" asp-action="Edit" asp-route-id="@merchant.Id" class="shadow ml-1 btn btn-primary">Edit</a>
                        </div>
                    }

                </div>
            </div>
        </div>
    }
</div>

@section Scripts {

    <script type='text/javascript'
            src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap'
            async defer></script>

    <script type='text/javascript'>

        function GetMap() {
            renderRequestsMap("myMap", getLocationsFromModelRequests());
        };

        function getLocationsFromModelRequests() {
            var requestData = [];

            @foreach (var merchant in Model){
                @:var reqData = {lat:@merchant.Latitude, long:@merchant.Longitude, name:'@merchant.Name'};
                @:console.log(reqData);
                @:requestData.push(reqData);
             }

            return requestData;
        }
    </script>
}